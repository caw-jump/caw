---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getPostBySlug } from '../../lib/dbLoader';

const { slug } = Astro.params;
const domain = Astro.locals.domain || Astro.request.headers.get('host') || 'chrisamaya.work';
const siteUrl = domain.includes('://') ? domain : `https://${domain}`;

const post = await getPostBySlug(siteUrl, slug as string);

if (!post) {
  return Astro.redirect('/404');
}
---

<BaseLayout title={`${post.title} | Chris Amaya`} description={post.excerpt ?? post.title} palette="emerald" crumbs={[{ name: 'Blog', url: '/blog' }, { name: post.title, url: `/blog/${post.slug}` }]}>
  <article class="py-16 max-w-3xl">
    <header class="mb-12">
      <h1 class="text-3xl md:text-4xl font-bold text-white">{post.title}</h1>
      <time class="text-sm text-white/50 mt-2 block" datetime={post.published_at ?? ''}>
        {post.published_at ? new Date(post.published_at).toLocaleDateString() : ''}
      </time>
    </header>
    <div class="prose prose-invert prose-lg max-w-none" set:html={post.content} />
  </article>
</BaseLayout>
