---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getPosts } from '../../lib/dbLoader';

const domain = Astro.locals.domain || Astro.request.headers.get('host') || 'chrisamaya.work';
const siteUrl = domain.includes('://') ? domain : `https://${domain}`;

const posts = await getPosts(siteUrl);
---

<BaseLayout title="Blog | Chris Amaya" description="Insights on systems, automation, and building technical teams that scale." palette="emerald">
  <div class="py-16">
    <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">Blog</h1>
    <p class="text-white/70 mb-12">Insights on systems, automation, and building technical teams that scale.</p>

    {posts.length === 0 ? (
      <p class="text-white/60">No posts yet.</p>
    ) : (
      <ul class="space-y-8">
        {posts.map((post) => (
          <li>
            <a href={`/blog/${post.slug}`} class="block group">
              <h2 class="text-xl font-semibold text-white group-hover:text-emerald-400 transition">{post.title}</h2>
              {post.excerpt && <p class="text-white/70 mt-2 line-clamp-2">{post.excerpt}</p>}
              <time class="text-sm text-white/50 mt-2 block" datetime={post.published_at || post.created_at || ''}>
                {post.published_at ? new Date(post.published_at).toLocaleDateString() : 'Draft'}
              </time>
            </a>
          </li>
        ))}
      </ul>
    )}
  </div>
</BaseLayout>
